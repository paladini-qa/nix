# Nix - Cursor Rules

## Visão Geral do Projeto

Este é um aplicativo de gerenciamento de finanças pessoais construído com React 19, TypeScript e Vite. Utiliza Supabase para backend (autenticação e banco de dados) e Gemini AI para análises inteligentes.

## Stack Tecnológica

- **Frontend**: React 19, TypeScript 5.8+
- **Build Tool**: Vite 6
- **Estilização**: MUI (Material-UI) v6 com suporte a dark/light mode
- **Backend**: Supabase (PostgreSQL, Auth, RLS)
- **Gráficos**: Recharts
- **IA**: Google Gemini AI (@google/genai)
- **Ícones**: MUI Icons (@mui/icons-material)
- **Markdown**: react-markdown

## Estrutura de Pastas

```
/
├── components/          # Componentes React
├── services/            # Serviços (Supabase, Gemini)
├── docs/                # Documentação e scripts SQL
├── theme.ts             # Configuração do tema MUI
├── App.tsx              # Componente principal
├── types.ts             # Tipos TypeScript
├── constants.ts         # Constantes da aplicação
└── index.tsx            # Ponto de entrada
```

## Convenções de Código

### TypeScript

- Use tipos explícitos para props de componentes e retornos de funções
- Defina interfaces em `types.ts` para tipos reutilizáveis
- Use `type` para union types e `interface` para objetos
- Prefira tipos estritos, evite `any`

```typescript
// ✅ Correto
interface Transaction {
  id: string;
  amount: number;
  type: TransactionType;
}

// ❌ Evite
const data: any = fetchData();
```

### Componentes React

- Use componentes funcionais com `React.FC`
- Nomeie componentes em PascalCase
- Um componente por arquivo
- Coloque componentes em `/components`
- Use hooks do React (useState, useEffect, useMemo, useCallback)

```typescript
// ✅ Padrão de componente
const MyComponent: React.FC<Props> = ({ prop1, prop2 }) => {
  const [state, setState] = useState<Type>(initialValue);

  return <Box>...</Box>;
};

export default MyComponent;
```

### Estilização com MUI

- Use o sistema `sx` prop para estilos inline
- Use componentes MUI em vez de elementos HTML nativos
- O tema suporta dark/light mode automaticamente
- Cores principais definidas em `theme.ts`:
  - Primary: Indigo (#6366f1)
  - Secondary: Pink (#ec4899)
  - Success: Emerald (#10b981)
  - Error: Red (#ef4444)
  - Warning: Amber (#f59e0b)

```typescript
// ✅ Padrão de estilização MUI
<Box
  sx={{
    bgcolor: 'background.paper',
    borderRadius: 2,
    p: 3,
    border: 1,
    borderColor: 'divider',
  }}
>
  <Typography variant="h6" color="text.primary">
    Título
  </Typography>
</Box>

// ✅ Uso do tema em sx
<Paper
  sx={{
    bgcolor: (theme) => theme.palette.mode === 'dark' ? 'grey.900' : 'grey.100',
  }}
/>
```

### Ícones (MUI Icons)

- Importe ícones de `@mui/icons-material`
- Use nomes descritivos ao renomear imports

```typescript
import {
  Add as AddIcon,
  Delete as DeleteIcon,
  Edit as EditIcon,
} from "@mui/icons-material";

<AddIcon fontSize="small" color="primary" />;
```

### Componentes MUI Comuns

```typescript
// Botões
<Button variant="contained" color="primary">Primary</Button>
<Button variant="outlined" color="secondary">Secondary</Button>
<Button variant="text" color="error">Danger</Button>

// Inputs
<TextField
  label="Email"
  fullWidth
  size="small"
  InputProps={{
    startAdornment: <InputAdornment position="start"><EmailIcon /></InputAdornment>
  }}
/>

// Select
<FormControl fullWidth>
  <InputLabel>Category</InputLabel>
  <Select value={value} label="Category" onChange={onChange}>
    <MenuItem value="option1">Option 1</MenuItem>
  </Select>
</FormControl>

// Cards
<Card>
  <CardContent>
    <Typography variant="h6">Title</Typography>
  </CardContent>
</Card>

// Dialogs
<Dialog open={open} onClose={onClose} maxWidth="sm" fullWidth>
  <DialogTitle>Title</DialogTitle>
  <DialogContent>Content</DialogContent>
  <DialogActions>
    <Button onClick={onClose}>Cancel</Button>
    <Button variant="contained">Confirm</Button>
  </DialogActions>
</Dialog>

// Grid (MUI v6)
<Grid container spacing={2}>
  <Grid size={{ xs: 12, md: 6 }}>
    Content
  </Grid>
</Grid>
```

### Supabase

- Cliente configurado em `services/supabaseClient.ts`
- Use variáveis de ambiente: `SUPABASE_URL`, `SUPABASE_ANON_KEY`
- Mapeie snake_case (banco) para camelCase (TypeScript)
- Sempre verifique `session` antes de operações autenticadas
- Trate erros com try/catch

```typescript
// ✅ Padrão de query Supabase
const { data, error } = await supabase
  .from("transactions")
  .select("*")
  .order("date", { ascending: false });

if (error) throw error;
```

### Gemini AI

- Serviço em `services/geminiService.ts`
- Use variável de ambiente: `GEMINI_API_KEY`
- Trate falhas graciosamente (API key opcional)

## Tipos Principais

```typescript
type TransactionType = "income" | "expense";
type ThemePreference = "light" | "dark" | "system";

interface Transaction {
  id: string;
  description: string;
  amount: number;
  type: TransactionType;
  category: string;
  paymentMethod: string;
  date: string; // YYYY-MM-DD
  createdAt: number;
  isRecurring?: boolean;
  frequency?: "monthly" | "yearly";
  installments?: number;
  currentInstallment?: number;
}

interface FinancialSummary {
  totalIncome: number;
  totalExpense: number;
  balance: number;
}
```

## Tema MUI

O tema está configurado em `theme.ts` com suporte a dark/light mode:

```typescript
// Acessar cores do tema
<Box sx={{ color: 'primary.main' }} />
<Box sx={{ bgcolor: 'background.paper' }} />
<Box sx={{ borderColor: 'divider' }} />

// Acesso condicional por modo
<Box sx={{
  bgcolor: (theme) => theme.palette.mode === 'dark' ? 'grey.800' : 'grey.100'
}} />
```

## Boas Práticas

1. **Estado**: Use `useMemo` para computações derivadas (filtros, somas)
2. **Efeitos**: Limpe subscriptions em `useEffect` com cleanup function
3. **Formulários**: Valide inputs antes de enviar ao Supabase
4. **Loading**: Use `CircularProgress` do MUI para estados de carregamento
5. **Erros**: Use `console.error` para logs e `Alert` do MUI para feedback
6. **Datas**: Use formato ISO `YYYY-MM-DD` para datas
7. **Moeda**: Formate valores com `Intl.NumberFormat`

## Variáveis de Ambiente

```env
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_ANON_KEY=xxx
GEMINI_API_KEY=xxx  # Opcional
```

## Comandos

```bash
npm run dev      # Desenvolvimento (localhost:3000)
npm run build    # Build de produção
npm run preview  # Preview do build
```

## Git e Conventional Commits

### Commits em Inglês

Sempre use **Conventional Commits** em **inglês** para mensagens de commit:

```
<type>(<scope>): <description>

[optional body]

[optional footer(s)]
```

### Tipos de Commit

| Tipo       | Descrição                                             |
| ---------- | ----------------------------------------------------- |
| `feat`     | Nova funcionalidade                                   |
| `fix`      | Correção de bug                                       |
| `docs`     | Alterações na documentação                            |
| `style`    | Formatação, ponto e vírgula, etc (sem mudança lógica) |
| `refactor` | Refatoração de código (sem nova feature ou fix)       |
| `perf`     | Melhoria de performance                               |
| `test`     | Adição ou correção de testes                          |
| `chore`    | Manutenção, configs, dependências                     |
| `ci`       | Alterações em CI/CD                                   |
| `build`    | Alterações no build ou dependências externas          |

### Exemplos de Commits

```bash
# ✅ Correto
git commit -m "feat(auth): add Google OAuth login"
git commit -m "fix(transactions): resolve date parsing error"
git commit -m "docs(readme): update installation instructions"
git commit -m "style(components): format code with prettier"
git commit -m "refactor(api): simplify supabase query logic"
git commit -m "chore(deps): update react to v19.2.3"

# ❌ Evite
git commit -m "fix bug"
git commit -m "changes"
git commit -m "wip"
git commit -m "Correção de erro na tela de login"  # Não usar português
```

### Escopo (Scope)

Escopos comuns neste projeto:

- `auth` - Autenticação (login, logout, session)
- `transactions` - Transações financeiras
- `dashboard` - Tela principal/dashboard
- `settings` - Configurações do usuário
- `charts` - Gráficos e visualizações
- `ai` - Integração com Gemini AI
- `ui` - Componentes de interface
- `api` - Serviços e integrações
- `deps` - Dependências

### Arquivos Ignorados (.gitignore)

Antes de fazer commit, verifique se os seguintes arquivos/pastas **NÃO** estão sendo enviados:

```
# Nunca commitar:
node_modules/        # Dependências (instalar via npm install)
dist/                # Build de produção
dist-ssr/            # Build SSR
.env                 # Variáveis de ambiente com secrets
*.local              # Arquivos locais
*.log                # Arquivos de log
.DS_Store            # Arquivos do macOS
.idea/               # Configurações do IntelliJ/WebStorm
.vscode/*            # Configurações do VSCode (exceto extensions.json)
```

### Checklist Antes do Commit

1. ✅ Verifique `git status` para ver arquivos modificados
2. ✅ Confirme que `.env` não está na lista de staged files
3. ✅ Use `git diff` para revisar as mudanças
4. ✅ Escreva a mensagem de commit em inglês
5. ✅ Siga o formato Conventional Commits
6. ✅ Seja específico no escopo e descrição

## O que Evitar

- ❌ Não use `any` em TypeScript
- ❌ Não faça queries sem verificar `session`
- ❌ Não commite arquivos `.env` ou outros arquivos do `.gitignore`
- ❌ Não use elementos HTML nativos quando há componentes MUI equivalentes
- ❌ Não crie componentes de classe, use funcionais
- ❌ Não ignore erros do Supabase
- ❌ Não faça commits em português (use inglês)
- ❌ Não faça commits genéricos como "fix", "update", "changes"
- ❌ Não commite `node_modules/`, `dist/`, ou arquivos de log

## Linguagem

- Comentários e documentação em português brasileiro
- Nomes de variáveis, funções e componentes em inglês
- Mensagens de UI podem ser em português ou inglês (manter consistência)
